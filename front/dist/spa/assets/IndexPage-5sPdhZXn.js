import{_ as k,c as g,o as d,w as l,a7 as w,aa as _,a9 as f,Q as c,a as s,e as r,b as o,af as y,f as p,O as v,t as m,a8 as x}from"./index-C_X-F3HM.js";import{Q as C}from"./QSpace-Bki6pcHf.js";import{Q as D}from"./QTooltip-CO4xKsLq.js";import{Q as N}from"./QPage-DR1ciFj4.js";import"./position-engine-DWVnpIet.js";const V={name:"IndexPage",data(){return{loading:!1,fullScreenChart:!1,filters:{date_from:"",date_to:""},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},porDia:[],pagos:[],chartVentas:{series:[],options:{}},chartPagos:{series:[],options:{}}}},mounted(){this.prefillDates(),this.fetchDashboard()},methods:{prefillDates(){const a=new Date,t=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),h=`${t}-${i}-01`,e=`${t}-${i}-${String(new Date(t,a.getMonth()+1,0).getDate()).padStart(2,"0")}`;this.filters.date_from=h,this.filters.date_to=e},async fetchDashboard(){this.loading=!0;try{const a={...this.filters},{data:t}=await this.$axios.get("reportes/ventas",{params:a});this.kpis=t?.kpis||this.kpis,this.porDia=t?.por_dia||[],this.pagos=t?.pagos||[],this.buildChartVentas(),this.buildChartPagos()}catch(a){const t=a?.response?.data?.message||"No se pudo cargar el dashboard";this.$q.notify?.({type:"negative",message:t})}finally{this.loading=!1}},buildChartVentas(){const a=this.porDia.map(e=>e.date),t=this.porDia.map(e=>Number(e.ingreso||0)),i=this.porDia.map(e=>Number(e.egreso||0)),h=this.porDia.map(e=>Number(e.neto||0));this.chartVentas={series:[{name:"Ingresos",data:t},{name:"Egresos",data:i},{name:"Neto",data:h}],options:{chart:{type:"bar",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},xaxis:{categories:a,labels:{rotate:-45}},yaxis:{labels:{formatter:e=>Number(e||0).toFixed(0)}},legend:{position:"top"},tooltip:{y:{formatter:e=>this.money(e)+" Bs"}}}}},buildChartPagos(){const a=this.pagos.map(i=>i.pago||"SN"),t=this.pagos.map(i=>Number(i.total||0));this.chartPagos={series:t,options:{labels:a,legend:{position:"bottom"},tooltip:{y:{formatter:i=>this.money(i)+" Bs"}}}}},money(a){return Number(a||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},S={class:"row items-center q-col-gutter-sm"},B={class:"col-12 col-sm-3"},Q={class:"col-12 col-sm-3"},P={class:"col-12 col-sm-3 col-md-2"},q={class:"row q-col-gutter-sm"},I={class:"col-6 col-sm-3"},A={class:"col-6 col-sm-3"},E={class:"col-6 col-sm-3"},F={class:"col-6 col-sm-3"},M={key:1,class:"row q-col-gutter-md q-mb-md"},R={class:"col-12 col-sm-6 col-md-3"},T={class:"text-h5 text-weight-bold"},L={class:"col-12 col-sm-6 col-md-3"},O={class:"text-h5 text-weight-bold"},U={class:"col-12 col-sm-6 col-md-3"},j={class:"text-h5 text-weight-bold"},z={class:"text-caption text-grey"},H={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h5 text-weight-bold"},G={class:"text-caption text-grey"},J={key:2,class:"row q-col-gutter-md"},K={class:"col-12 col-md-8"},W={key:1,class:"text-grey text-center q-pa-md text-caption"},X={class:"col-12 col-md-4"},Z={key:1,class:"text-grey text-center q-pa-md text-caption"};function $(a,t,i,h,e,u){const b=w("apexchart");return d(),g(N,{class:"q-pa-md bg-grey-3"},{default:l(()=>[a.$store.user.role=="Administrador"?(d(),g(c,{key:0,flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[s(r,null,{default:l(()=>[o("div",S,[t[7]||(t[7]=o("div",{class:"col-12 col-md-6"},[o("div",{class:"text-h5 text-weight-bold"}," Dashboard general "),o("div",{class:"text-caption text-grey-7"}," Resumen rápido de ventas, caja e insumos ")],-1)),o("div",B,[s(y,{modelValue:e.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=n=>e.filters.date_from=n),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Q,[s(y,{modelValue:e.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=n=>e.filters.date_to=n),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),o("div",P,[s(p,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",class:"full-width",loading:e.loading,onClick:u.fetchDashboard},null,8,["loading","onClick"])])])]),_:1}),s(v),s(r,null,{default:l(()=>[o("div",q,[o("div",I,[s(p,{color:"primary",icon:"point_of_sale",label:"Nueva venta","no-caps":"",class:"full-width",onClick:t[2]||(t[2]=n=>a.$router.push({path:"/ventas"}))})]),o("div",A,[s(p,{color:"teal",icon:"shopping_cart",label:"Nueva compra","no-caps":"",class:"full-width",onClick:t[3]||(t[3]=n=>a.$router.push({path:"/compras"}))})]),o("div",E,[s(p,{color:"indigo",icon:"inventory_2",label:"Productos","no-caps":"",class:"full-width",onClick:t[4]||(t[4]=n=>a.$router.push({path:"/productos"}))})]),o("div",F,[s(p,{color:"orange",outline:"",icon:"insights",label:"Reportes detallados","no-caps":"",class:"full-width",onClick:t[5]||(t[5]=n=>a.$router.push({path:"/reportes"}))})])])]),_:1})]),_:1})):_("",!0),a.$store.user.role=="Administrador"?(d(),f("div",M,[o("div",R,[s(c,{flat:"",bordered:"",class:"kpi kpi-green"},{default:l(()=>[s(r,null,{default:l(()=>[t[8]||(t[8]=o("div",{class:"text-caption text-positive"},"Ingresos",-1)),o("div",T,m(u.money(e.kpis.ingresos))+" Bs ",1)]),_:1})]),_:1})]),o("div",L,[s(c,{flat:"",bordered:"",class:"kpi kpi-red"},{default:l(()=>[s(r,null,{default:l(()=>[t[9]||(t[9]=o("div",{class:"text-caption text-negative"},"Egresos",-1)),o("div",O,m(u.money(e.kpis.egresos))+" Bs ",1)]),_:1})]),_:1})]),o("div",U,[s(c,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:l(()=>[s(r,null,{default:l(()=>[t[10]||(t[10]=o("div",{class:"text-caption"},"Neto",-1)),o("div",j,m(u.money(e.kpis.neto))+" Bs ",1),o("div",z," Ticket prom.: "+m(u.money(e.kpis.ticket_promedio))+" Bs ",1)]),_:1})]),_:1})]),o("div",H,[s(c,{flat:"",bordered:"",class:"kpi"},{default:l(()=>[s(r,null,{default:l(()=>[t[11]||(t[11]=o("div",{class:"text-caption"},"Resumen de ventas",-1)),o("div",Y,m(e.kpis.ventas)+" ventas ",1),o("div",G," Ítems vendidos: "+m(e.kpis.items),1)]),_:1})]),_:1})])])):_("",!0),a.$store.user.role=="Administrador"?(d(),f("div",J,[o("div",K,[s(c,{flat:"",bordered:""},{default:l(()=>[s(r,{class:"row items-center"},{default:l(()=>[t[13]||(t[13]=o("div",{class:"text-subtitle1 text-weight-bold"}," Movimiento diario (Ingresos vs Egresos vs Neto) ",-1)),s(C),s(p,{dense:"",flat:"",icon:"fullscreen",round:"",onClick:t[6]||(t[6]=n=>e.fullScreenChart=!e.fullScreenChart)},{default:l(()=>[s(D,null,{default:l(()=>[...t[12]||(t[12]=[x(" Cambiar tamaño ",-1)])]),_:1})]),_:1})]),_:1}),s(v),s(r,null,{default:l(()=>[e.chartVentas.series.length?(d(),g(b,{key:0,type:"bar",height:"320",options:e.chartVentas.options,series:e.chartVentas.series},null,8,["options","series"])):(d(),f("div",W," No hay datos en el rango seleccionado. "))]),_:1})]),_:1})]),o("div",X,[s(c,{flat:"",bordered:""},{default:l(()=>[s(r,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...t[14]||(t[14]=[x(" Ventas por tipo de pago ",-1)])]),_:1}),s(v),s(r,null,{default:l(()=>[e.chartPagos.series.length?(d(),g(b,{key:0,type:"donut",height:"320",options:e.chartPagos.options,series:e.chartPagos.series},null,8,["options","series"])):(d(),f("div",Z," No hay ventas por tipo de pago en este rango. "))]),_:1})]),_:1})])])):_("",!0)]),_:1})}const lt=k(V,[["render",$],["__scopeId","data-v-eb13f81d"]]);export{lt as default};
