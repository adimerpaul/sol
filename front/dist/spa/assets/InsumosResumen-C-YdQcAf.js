import{_ as Q,c as v,o as p,w as r,b as s,a as t,Q as g,e as m,f as n,af as u,a9 as _,ab as V,ac as w,t as d,O as N,aa as S,a8 as b,h as k,ah as q}from"./index-C_X-F3HM.js";import{Q as y}from"./QSpace-Bki6pcHf.js";import{c as U,Q as D,b as C,a as x}from"./QList-qWoK3SC4.js";import{Q as I}from"./QPage-DR1ciFj4.js";const B={name:"InsumosResumen",data(){const a=new Date().toISOString().substr(0,10);return{loading:!1,search:"",insumos:[],carrito:[],qtyDlg:!1,current:null,form:{cantidad:null,costo:null},payDlg:!1,compra:{fecha:a,proveedor:"",nota:""}}},computed:{filteredInsumos(){const a=(this.search||"").toLowerCase();return a?this.insumos.filter(e=>String(e.nombre||"").toLowerCase().includes(a)||String(e.unidad||"").toLowerCase().includes(a)||String(e.descripcion||"").toLowerCase().includes(a)):this.insumos},total(){return this.carrito.reduce((a,e)=>{const c=Number(e.cantidad||0),h=Number(e.costo||0);return a+c*h},0)}},mounted(){this.insumosGet()},methods:{to2(a){return Number(a||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},money(a){return this.to2(a)},async insumosGet(){this.loading=!0;try{const a=await this.$axios.get("insumos");this.insumos=Array.isArray(a.data)?a.data:[]}catch{this.$alert&&this.$alert.error&&this.$alert.error("No se pudo cargar los insumos")}finally{this.loading=!1}},openQtyDialog(a){this.current=a,this.form={cantidad:1,costo:Number(a.costo||0)},this.addToCart()},addToCart(){const a=Number(this.form.cantidad||0),e=Number(this.form.costo||0),c=this.carrito.findIndex(h=>h.id===this.current.id);c>=0?(this.carrito[c].cantidad+=a,this.carrito[c].costo=e):this.carrito.push({id:this.current.id,nombre:this.current.nombre,unidad:this.current.unidad,cantidad:a,costo:e}),this.qtyDlg=!1},removeFromCart(a){this.carrito=this.carrito.filter(e=>e.id!==a)},clearCart(){this.carrito=[]},openPayDialog(){if(!this.carrito.length){this.$alert&&this.$alert.error&&this.$alert.error("Carrito vacío");return}this.payDlg=!0},async savePurchase(){const a={fecha:this.compra.fecha,proveedor:this.compra.proveedor||null,nota:this.compra.nota||null,detalles:this.carrito.map(e=>({insumo_id:e.id,cantidad:Number(e.cantidad||0),costo:Number(e.costo||0)}))};this.loading=!0;try{await this.$axios.post("compras",a),this.$alert&&this.$alert.success&&this.$alert.success("Compra registrada"),this.payDlg=!1,this.carrito=[],this.compra.proveedor="",this.compra.nota="",this.insumosGet()}catch(e){const c=e&&e.response&&e.response.data&&e.response.data.message?e.response.data.message:"No se pudo registrar la compra";this.$alert&&this.$alert.error&&this.$alert.error(c)}finally{this.loading=!1}}}},L={class:"row"},F={class:"col-12 col-md-8"},P={class:"row items-center"},T={class:"col-12"},A={class:"col-12 col-md-6 q-pa-xs"},G={class:"col-12 col-md-6 q-pa-xs text-right"},M={class:"row q-mt-sm"},O=["onClick"],R={class:"col-8"},E={class:"text-body1"},j={class:"text-caption text-grey"},z={class:"col-4 text-right"},H={class:"text-body1"},J={class:"col-12 col-md-4"},K={class:"row q-col-gutter-xs"},W={class:"col-6"},X={class:"col-6"},Y={class:"text-bold"},Z={class:"q-mt-sm text-right text-subtitle1"},$={class:"text-subtitle1"},ee={class:"text-caption q-mb-xs"},te={class:"row q-col-gutter-sm"},oe={class:"col-12 col-sm-6"},se={class:"col-12 col-sm-6"},le={class:"col-12"},ae={class:"q-mt-sm text-right text-subtitle1"};function re(a,e,c,h,l,i){return p(),v(I,{class:"bg-grey-3 q-pa-sm"},{default:r(()=>[s("div",L,[s("div",F,[t(g,null,{default:r(()=>[t(m,{class:"q-pa-sm"},{default:r(()=>[s("div",P,[s("div",T,[t(n,{flat:"",color:"primary",icon:"shopping_cart",label:"Ir a Compras","no-caps":"",href:"/compras"})]),s("div",A,[t(u,{modelValue:l.search,"onUpdate:modelValue":e[0]||(e[0]=o=>l.search=o),dense:"",outlined:"",placeholder:"Buscar insumo (nombre, unidad, descripción)"},null,8,["modelValue"])]),s("div",G,[t(n,{flat:"",color:"primary",icon:"refresh",loading:l.loading,onClick:i.insumosGet},null,8,["loading","onClick"])])]),s("div",M,[e[12]||(e[12]=s("div",{class:"col-8"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Insumo")],-1)),e[13]||(e[13]=s("div",{class:"col-4 text-right"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Stock")],-1)),(p(!0),_(V,null,w(i.filteredInsumos,o=>(p(),_("div",{key:o.id,class:"col-12 q-mt-sm"},[s("div",{class:"row cursor-pointer",onClick:f=>i.openQtyDialog(o)},[s("div",R,[s("div",E,d(o.nombre),1),s("div",j,d(o.unidad)+" — "+d(o.descripcion||"—"),1)]),s("div",z,[s("div",H,d(i.to2(o.stock)),1)])],8,O),t(N,{spaced:"",inset:""})]))),128))])]),_:1})]),_:1})]),s("div",J,[t(g,null,{default:r(()=>[t(m,{class:"q-pa-sm row items-center bg-yellow-3"},{default:r(()=>[e[14]||(e[14]=s("div",{class:"text-subtitle1 text-bold"},"Carrito",-1)),t(y),t(n,{dense:"",color:"red",icon:"delete_sweep",label:"Limpiar","no-caps":"",onClick:i.clearCart},null,8,["onClick"])]),_:1}),t(m,{class:"q-pa-sm"},{default:r(()=>[t(U,{bordered:"",dense:""},{default:r(()=>[(p(!0),_(V,null,w(l.carrito,o=>(p(),v(D,{key:o.id},{default:r(()=>[t(C,null,{default:r(()=>[t(x,{class:"text-bold"},{default:r(()=>[b(d(o.nombre),1)]),_:2},1024),t(x,{caption:""},{default:r(()=>[s("div",K,[s("div",W,[t(u,{modelValue:o.cantidad,"onUpdate:modelValue":f=>o.cantidad=f,modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Cantidad"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",X,[t(u,{modelValue:o.costo,"onUpdate:modelValue":f=>o.costo=f,modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Costo (Bs)"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024),t(C,{side:"",class:"text-right"},{default:r(()=>[s("div",Y,d(i.money(o.cantidad*o.costo)),1),t(n,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:f=>i.removeFromCart(o.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l.carrito.length?S("",!0):(p(),v(D,{key:0},{default:r(()=>[t(C,null,{default:r(()=>[t(x,{caption:""},{default:r(()=>[...e[15]||(e[15]=[b("Carrito vacío",-1)])]),_:1})]),_:1})]),_:1}))]),_:1}),s("div",Z,[e[16]||(e[16]=s("b",null,"Total:",-1)),b(" "+d(i.money(i.total))+" Bs ",1)]),t(n,{class:"q-mt-md",color:"indigo",icon:"shopping_cart",label:"Registrar compra",disable:!l.carrito.length,loading:l.loading,"no-caps":"",onClick:i.openPayDialog},null,8,["disable","loading","onClick"])]),_:1})]),_:1})])]),t(k,{modelValue:l.qtyDlg,"onUpdate:modelValue":e[5]||(e[5]=o=>l.qtyDlg=o)},{default:r(()=>[t(g,{style:{width:"420px","max-width":"90vw"}},{default:r(()=>[t(m,{class:"row items-center q-pb-none"},{default:r(()=>[s("div",$,"Agregar: "+d(l.current?.nombre),1),t(y),t(n,{flat:"",round:"",dense:"",icon:"close",onClick:e[1]||(e[1]=o=>l.qtyDlg=!1)})]),_:1}),t(m,{class:"q-pt-none"},{default:r(()=>[s("div",ee,"Unidad: "+d(l.current?.unidad)+" | Stock: "+d(i.to2(l.current?.stock)),1),t(u,{modelValue:l.form.cantidad,"onUpdate:modelValue":e[2]||(e[2]=o=>l.form.cantidad=o),modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Cantidad",class:"q-mb-sm"},null,8,["modelValue"]),t(u,{modelValue:l.form.costo,"onUpdate:modelValue":e[3]||(e[3]=o=>l.form.costo=o),modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Costo (Bs)"},null,8,["modelValue"])]),_:1}),t(q,{align:"right"},{default:r(()=>[t(n,{flat:"",label:"Cancelar",color:"negative","no-caps":"",onClick:e[4]||(e[4]=o=>l.qtyDlg=!1)}),t(n,{label:"Agregar",color:"primary","no-caps":"",onClick:i.addToCart},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:l.payDlg,"onUpdate:modelValue":e[11]||(e[11]=o=>l.payDlg=o)},{default:r(()=>[t(g,{style:{width:"540px","max-width":"95vw"}},{default:r(()=>[t(m,{class:"row items-center q-pb-none"},{default:r(()=>[e[17]||(e[17]=s("div",{class:"text-subtitle1"},"Confirmar compra",-1)),t(y),t(n,{flat:"",round:"",dense:"",icon:"close",onClick:e[6]||(e[6]=o=>l.payDlg=!1)})]),_:1}),t(m,{class:"q-pt-none"},{default:r(()=>[s("div",te,[s("div",oe,[t(u,{modelValue:l.compra.fecha,"onUpdate:modelValue":e[7]||(e[7]=o=>l.compra.fecha=o),label:"Fecha",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),s("div",se,[t(u,{modelValue:l.compra.proveedor,"onUpdate:modelValue":e[8]||(e[8]=o=>l.compra.proveedor=o),label:"Proveedor",dense:"",outlined:""},null,8,["modelValue"])]),s("div",le,[t(u,{modelValue:l.compra.nota,"onUpdate:modelValue":e[9]||(e[9]=o=>l.compra.nota=o),label:"Nota",type:"textarea",autogrow:"",dense:"",outlined:""},null,8,["modelValue"])])]),s("div",ae,[e[18]||(e[18]=s("b",null,"Total:",-1)),b(" "+d(i.money(i.total))+" Bs ",1)])]),_:1}),t(q,{align:"right"},{default:r(()=>[t(n,{flat:"",color:"negative",label:"Cancelar","no-caps":"",onClick:e[10]||(e[10]=o=>l.payDlg=!1)}),t(n,{color:"positive",label:"Guardar","no-caps":"",loading:l.loading,onClick:i.savePurchase},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ue=Q(B,[["render",re]]);export{ue as default};
