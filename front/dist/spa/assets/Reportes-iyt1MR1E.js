import{_ as x,c as v,o as w,w as l,a as e,b as a,Q as d,e as n,af as _,f as k,t as i,a8 as m,O as f}from"./index-C_X-F3HM.js";import{Q as y}from"./QSelect-yiKOhsGz.js";import{Q as b}from"./QSpace-Bki6pcHf.js";import{Q as u}from"./QBadge-DpCJJl60.js";import{Q as g}from"./QTable-CjRZV8sk.js";import{Q as N}from"./QPage-DR1ciFj4.js";import{h}from"./moment-BLMuvzoS.js";import"./format-CnsH0mh1.js";import"./position-engine-DWVnpIet.js";import"./QList-qWoK3SC4.js";const q={name:"ReportesPage",data(){return{loading:!1,users:[],filters:{date_from:"",date_to:"",user_id:null},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},pagos:[],mesas:[],qr:{total:0,items:0},porDia:[],insumos:[],insumosResumen:{costo_insumos:0,ingresos:0,ganancia_aprox:0,cantidad_usada:0,stock_actual:0,cantidad_total:0},colsPagos:[{name:"pago",label:"Pago",field:"pago",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:s=>Number(s).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:s=>Number(s||0).toFixed(2)}],colsMesas:[{name:"mesa",label:"Mesa",field:"mesa",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:s=>Number(s).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:s=>Number(s||0).toFixed(2)}],colsDia:[{name:"date",label:"Fecha",field:"date",align:"left"},{name:"ingreso",label:"Ingreso",field:"ingreso",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"egreso",label:"Egreso",field:"egreso",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"neto",label:"Neto",field:"neto",align:"right",format:s=>Number(s||0).toFixed(2)}],colsInsumos:[{name:"nombre",label:"Insumo",field:"nombre",align:"left"},{name:"unidad",label:"Unidad",field:"unidad",align:"left"},{name:"total_cant",label:"Total",field:"total_cant",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"usado",label:"Cant. usada",field:"usado",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"stock_actual",label:"Stock actual",field:"stock_actual",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"costo",label:"Costo unit. (Bs)",field:"costo",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"costo_total",label:"Costo total (Bs)",field:"costo_total",align:"right",format:s=>Number(s||0).toFixed(2)}]}},mounted(){this.prefillDates(),this.loadUsers(),this.fetchAll()},methods:{prefillDates(){this.filters.date_from=h().format("YYYY-MM-DD"),this.filters.date_to=h().format("YYYY-MM-DD")},async loadUsers(){try{const{data:s}=await this.$axios.get("users");this.users=Array.isArray(s?.data)?s.data:Array.isArray(s)?s:[]}catch{}},async fetchAll(){this.loading=!0;try{const s={...this.filters},t=await this.$axios.get("reportes/ventas",{params:s});this.kpis=t.data?.kpis||this.kpis,this.pagos=t.data?.pagos||[],this.qr=t.data?.qr||{total:0,items:0},this.mesas=t.data?.mesas||[],this.porDia=t.data?.por_dia||[];const p=await this.$axios.get("reportes/insumos",{params:s});this.insumos=p.data?.consumo||[],this.insumosResumen=p.data?.resumen||this.insumosResumen}catch(s){const t=s?.response?.data?.message||"No se pudieron obtener los reportes";this.$q.notify?.({type:"negative",message:t})}finally{this.loading=!1}},money(s){return Number(s||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},qty(s){return Number(s||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},B={class:"col-12 col-sm-3"},D={class:"col-12 col-sm-3"},Q={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-3"},C={class:"row q-col-gutter-md q-mb-md"},V={class:"col-12 col-sm-6 col-md-3"},R={class:"text-h5 text-weight-bold"},S={class:"col-12 col-sm-6 col-md-3"},M={class:"text-h5 text-weight-bold"},Y={class:"col-12 col-sm-6 col-md-3"},A={class:"text-h5 text-weight-bold"},I={class:"col-12 col-sm-6 col-md-3"},T={class:"text-h5 text-weight-bold"},U={class:"text-caption text-grey"},P={class:"row q-col-gutter-md q-mb-md"},L={class:"col-12 col-md-6"},O={class:"col-12 col-md-6"};function E(s,t,p,G,o,r){return w(),v(N,{class:"q-pa-md bg-grey-3"},{default:l(()=>[e(d,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[e(n,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[a("div",B,[e(_,{modelValue:o.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=c=>o.filters.date_from=c),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),a("div",D,[e(_,{modelValue:o.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=c=>o.filters.date_to=c),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),a("div",Q,[e(y,{modelValue:o.filters.user_id,"onUpdate:modelValue":t[2]||(t[2]=c=>o.filters.user_id=c),options:o.users,"option-value":"id","option-label":"name","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options"])]),a("div",F,[e(k,{color:"primary",icon:"search",label:"Consultar",loading:o.loading,"no-caps":"",class:"full-width",onClick:r.fetchAll},null,8,["loading","onClick"])])]),_:1})]),_:1}),a("div",C,[a("div",V,[e(d,{flat:"",bordered:"",class:"kpi kpi-green"},{default:l(()=>[e(n,null,{default:l(()=>[t[3]||(t[3]=a("div",{class:"text-caption text-positive"},"Ingresos",-1)),a("div",R,i(r.money(o.kpis.ingresos))+" Bs",1)]),_:1})]),_:1})]),a("div",S,[e(d,{flat:"",bordered:"",class:"kpi kpi-red"},{default:l(()=>[e(n,null,{default:l(()=>[t[4]||(t[4]=a("div",{class:"text-caption text-negative"},"Egresos",-1)),a("div",M,i(r.money(o.kpis.egresos))+" Bs",1)]),_:1})]),_:1})]),a("div",Y,[e(d,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:l(()=>[e(n,null,{default:l(()=>[t[5]||(t[5]=a("div",{class:"text-caption"},"Neto",-1)),a("div",A,i(r.money(o.kpis.neto))+" Bs",1)]),_:1})]),_:1})]),a("div",I,[e(d,{flat:"",bordered:"",class:"kpi"},{default:l(()=>[e(n,null,{default:l(()=>[t[6]||(t[6]=a("div",{class:"text-caption"},"Ticket promedio",-1)),a("div",T,i(r.money(o.kpis.ticket_promedio))+" Bs",1),a("div",U," #ventas: "+i(o.kpis.ventas)+" · ítems: "+i(o.kpis.items),1)]),_:1})]),_:1})])]),a("div",P,[a("div",L,[e(d,{flat:"",bordered:""},{default:l(()=>[e(n,{class:"row items-center"},{default:l(()=>[t[7]||(t[7]=a("div",{class:"text-subtitle1 text-weight-bold"},"Pagos",-1)),e(b),e(u,{color:"blue",outline:""},{default:l(()=>[m(" QR: "+i(r.money(o.qr.total))+" Bs ("+i(o.qr.items)+") ",1)]),_:1})]),_:1}),e(f),e(g,{rows:o.pagos,columns:o.colsPagos,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})]),a("div",O,[e(d,{flat:"",bordered:""},{default:l(()=>[e(n,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...t[8]||(t[8]=[m(" Mesas ",-1)])]),_:1}),e(f),e(g,{rows:o.mesas,columns:o.colsMesas,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})])]),e(d,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[e(n,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...t[9]||(t[9]=[m(" Movimiento por día ",-1)])]),_:1}),e(f),e(g,{rows:o.porDia,columns:o.colsDia,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1}),e(d,{flat:"",bordered:""},{default:l(()=>[e(n,{class:"row items-center"},{default:l(()=>[...t[10]||(t[10]=[a("div",{class:"text-subtitle1 text-weight-bold"},"Consumo de insumos",-1)])]),_:1}),e(f),e(g,{rows:o.insumos,columns:o.colsInsumos,dense:"",flat:"",bordered:"","rows-per-page-options":[0,20,50,100]},null,8,["rows","columns"]),e(f),e(n,{class:"row items-center q-gutter-sm"},{default:l(()=>[e(u,{color:"orange",outline:""},{default:l(()=>[m(" Cantidad usada: "+i(r.qty(o.insumosResumen.cantidad_usada)),1)]),_:1}),e(u,{color:"indigo",outline:""},{default:l(()=>[m(" Stock actual: "+i(r.qty(o.insumosResumen.stock_actual)),1)]),_:1}),e(u,{color:"teal",outline:""},{default:l(()=>[m(" Total (usado + stock): "+i(r.qty(o.insumosResumen.cantidad_total)),1)]),_:1}),e(b),e(u,{color:"brown",outline:""},{default:l(()=>[m(" Costo insumos: "+i(r.money(o.insumosResumen.costo_insumos))+" Bs ",1)]),_:1}),e(u,{color:"green",outline:""},{default:l(()=>[m(" Ganancia aprox: "+i(r.money(o.insumosResumen.ganancia_aprox))+" Bs ",1)]),_:1})]),_:1})]),_:1})]),_:1})}const se=x(q,[["render",E],["__scopeId","data-v-f06d7f20"]]);export{se as default};
