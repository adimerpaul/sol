import{_ as U,c as y,o as d,w as i,b as s,a as l,Q as b,e as p,af as h,a9 as c,a8 as f,ab as v,ac as x,t as r,f as m,aa as C,d as Q,ao as N,h as D,O as A,ah as B}from"./index-D17d9CED.js";import{Q as I}from"./format-C2NjPuPn.js";import{Q as _}from"./QSpace-CRJFh_fq.js";import{Q as E}from"./QBadge-CfV2PV27.js";import{c as P,Q as S,b as V,a as k}from"./QList-DtAzkZzK.js";import{Q as w}from"./QSelect-CvCEXiBv.js";import{Q as L}from"./QPage-Mqie5rLH.js";import{I as T}from"./ImprimirTicket-CSMN7aKQ.js";import"./position-engine-DqQ8RByf.js";const M={name:"VentasPage",data(){return{loading:!1,products:[],categories:[{id:"Refrescos y Bebidas",name:"Refrescos y Bebidas",icon:"local_drink",color:"blue"},{id:"Acompañamientos",name:"Acompañamientos",icon:"restaurant",color:"teal"},{id:"Pollos",name:"Pollos",icon:"lunch_dining",color:"brown"}],search:"",categoryId:"",cart:[],payDlg:!1,client:{ci:"",name:"SN",mesa:"MESA",pago:"EFECTIVO",llamada:0,comment:""},recibido:"",cantidades:Array.from({length:100},(a,e)=>e+1)}},computed:{filteredProducts(){const a=(this.search||"").toLowerCase();return this.products.filter(e=>{const u=!this.categoryId||e.category_id===this.categoryId,q=!a||String(e.name||"").toLowerCase().includes(a)||String(e.description||"").toLowerCase().includes(a);return u&&q})},total(){return this.cart.reduce((a,e)=>a+Number(e.price||0)*Number(e.cantidadSale||0),0)}},mounted(){this.fetchAll()},methods:{money(a){return Number(a||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},imageUrl(a){return a.image_url||`${this.$url}/../storage/${a.image}`},async fetchAll(){this.loading=!0,this.$axios.get("productos").then(({data:a})=>{const e=Array.isArray(a)?a:[];this.products=e.map(u=>({...u,price:Number(u.price||0)}))}).catch(()=>{this.$q.notify?.({type:"negative",message:"No se pudieron cargar los productos"})}).finally(()=>{this.loading=!1})},selectCategory(a){this.categoryId=a},addToCart(a){const e=this.cart.findIndex(u=>u.id===a.id);e>=0?this.cart[e].cantidadSale+=1:this.cart.push({id:a.id,name:a.name,price:Number(a.price||0),cantidadSale:1}),this.$q.notify?.({type:"positive",message:`${a.name} agregado`})},removeFromCart(a){this.cart=this.cart.filter(e=>e.id!==a)},clearCart(){this.cart=[]},openPayDialog(){if(!this.cart.length){this.$q.notify?.({type:"warning",message:"Carrito vacío"});return}this.recibido="",this.payDlg=!0},toUpperName(){this.client.name=(this.client.name||"").toUpperCase()},async searchClient(){if(!this.client.ci){this.client.name="SN";return}try{const{data:a}=await this.$axios.get(`searchClient/${this.client.ci}`);a&&a.name&&(this.client.name=a.name)}catch{}},async submitSale(){if(!this.cart.length){this.$q.notify?.({type:"negative",message:"Carrito vacío"});return}this.loading=!0;try{const a={client:this.client,products:this.cart,mesa:this.client.mesa,llamada:this.client.llamada,pago:this.client.pago,comment:this.client.comment||""},{data:e}=await this.$axios.post("sales",a);this.$q.notify?.({type:"positive",message:"Venta realizada"}),T.ticket(e),this.cart=[],this.payDlg=!1,this.client={ci:"",name:"SN",mesa:"MESA",pago:"EFECTIVO",llamada:0,comment:""},this.recibido=""}catch(a){const e=a?.response?.data?.message||"No se pudo registrar la venta";this.$q.notify?.({type:"negative",message:e})}finally{this.loading=!1}}}},F={class:"row"},O={class:"col-12 col-md-8"},R={class:"row items-center q-col-gutter-sm"},z={class:"col-12 col-sm-4"},Y={class:"col-12 col-sm-8"},j={class:"row items-center q-gutter-xs"},G={class:"row q-col-gutter-md q-mt-sm"},H={class:"relative-position",style:{height:"160px",background:"#111"}},J=["src"],K={key:1,class:"full-width full-height flex flex-center text-white"},W={class:"absolute-bottom-right q-ma-sm bg-red text-white",style:{padding:"4px 10px","border-radius":"999px","font-weight":"700"}},X={class:"absolute-bottom bg-gradient text-white q-pa-sm"},Z={class:"text-subtitle2 text-weight-bold ellipsis-2-lines"},$={class:"row items-center"},ee={class:"text-caption text-grey"},te={key:0,class:"col-12"},le={class:"col-12 col-md-4"},oe={class:"row q-col-gutter-xs"},se={class:"col-5"},ae={class:"col-5"},ie={class:"col-2 flex flex-center"},ne={class:"text-bold"},de={class:"q-mt-sm text-right text-subtitle1"},re={class:"row q-col-gutter-sm"},ce={class:"col-12 col-md-3"},me={class:"col-12 col-md-5"},ue={class:"col-6 col-md-2"},ge={class:"col-6 col-md-2"},pe={class:"col-6 col-md-2"},he={class:"col-12 col-md-10"},fe={class:"row items-center q-col-gutter-sm"},be={class:"col-12 col-md-4"},ye={class:"col-12 col-md-4 text-red text-subtitle1 text-bold"},_e={class:"col-12 col-md-4 text-blue text-subtitle1 text-bold"},ve={key:0};function xe(a,e,u,q,o,n){return d(),y(L,{class:"bg-grey-3 q-pa-sm"},{default:i(()=>[s("div",F,[s("div",O,[l(b,{flat:"",bordered:""},{default:i(()=>[l(p,{class:"q-pa-sm"},{default:i(()=>[s("div",R,[s("div",z,[l(h,{modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.search=t),dense:"",outlined:"",debounce:"300",placeholder:"Buscar producto..."},null,8,["modelValue"])]),s("div",Y,[s("div",j,[l(I,{clickable:"",color:o.categoryId===""?"indigo":"grey-4","text-color":o.categoryId===""?"white":"black",icon:"public",onClick:e[1]||(e[1]=t=>n.selectCategory(""))},{default:i(()=>[...e[12]||(e[12]=[f("Todo",-1)])]),_:1},8,["color","text-color"]),(d(!0),c(v,null,x(o.categories,t=>(d(),y(I,{key:t.id,clickable:"",color:o.categoryId===t.id?t.color||"indigo":"grey-4","text-color":o.categoryId===t.id?"white":"black",icon:t.icon||"category",onClick:g=>n.selectCategory(t.id)},{default:i(()=>[f(r(t.name),1)]),_:2},1032,["color","text-color","icon","onClick"]))),128)),l(_),l(m,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:n.fetchAll},null,8,["loading","onClick"])])])]),s("div",G,[(d(!0),c(v,null,x(n.filteredProducts,t=>(d(),c("div",{key:t.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[l(b,{class:"hoverable cursor-pointer",onClick:g=>n.addToCart(t)},{default:i(()=>[s("div",H,[t.image?(d(),c("img",{key:0,src:n.imageUrl(t),alt:"",style:{width:"100%",height:"100%","object-fit":"cover"},loading:"lazy"},null,8,J)):(d(),c("div",K,[l(Q,{name:"image",size:"48px"})])),s("div",W,r(n.money(t.price))+" Bs ",1),s("div",X,[s("div",Z,r(t.name),1)])]),l(p,{class:"q-py-xs"},{default:i(()=>[s("div",$,[l(E,{outline:"",color:"grey-7",class:"q-mr-sm"},{default:i(()=>[f(r(t.unit||"UND"),1)]),_:2},1024),s("div",ee,r(t.categoria||"—"),1),l(_),l(m,{dense:"",round:"",flat:"",icon:"add_shopping_cart",onClick:N(g=>n.addToCart(t),["stop"])},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128)),!o.loading&&!n.filteredProducts.length?(d(),c("div",te,[l(b,{flat:"",bordered:""},{default:i(()=>[l(p,{class:"text-center text-grey"},{default:i(()=>[...e[13]||(e[13]=[f("No hay productos",-1)])]),_:1})]),_:1})])):C("",!0)])]),_:1})]),_:1})]),s("div",le,[l(b,{flat:"",bordered:""},{default:i(()=>[l(p,{class:"q-pa-sm row items-center bg-yellow-3"},{default:i(()=>[e[14]||(e[14]=s("div",{class:"text-subtitle1 text-bold"},"Carrito",-1)),l(_),l(m,{dense:"",color:"red",icon:"delete_sweep",label:"Limpiar","no-caps":"",onClick:n.clearCart},null,8,["onClick"])]),_:1}),l(p,{class:"q-pa-sm"},{default:i(()=>[l(P,{bordered:"",dense:""},{default:i(()=>[(d(!0),c(v,null,x(o.cart,t=>(d(),y(S,{key:t.id},{default:i(()=>[l(V,null,{default:i(()=>[l(k,{class:"text-bold"},{default:i(()=>[f(r(t.name),1)]),_:2},1024),l(k,{caption:""},{default:i(()=>[s("div",oe,[s("div",se,[l(h,{modelValue:t.price,"onUpdate:modelValue":g=>t.price=g,modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ae,[l(h,{modelValue:t.cantidadSale,"onUpdate:modelValue":g=>t.cantidadSale=g,modelModifiers:{number:!0},type:"number",step:"1",min:"1",dense:"",outlined:""},{prepend:i(()=>[l(Q,{name:"shopping_cart",size:"14px"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",ie,[l(m,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:g=>n.removeFromCart(t.id)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024),l(V,{side:"",class:"text-right"},{default:i(()=>[s("div",ne,r(n.money(t.price*t.cantidadSale)),1)]),_:2},1024)]),_:2},1024))),128)),o.cart.length?C("",!0):(d(),y(S,{key:0},{default:i(()=>[l(V,null,{default:i(()=>[l(k,{caption:""},{default:i(()=>[...e[15]||(e[15]=[f("Carrito vacío",-1)])]),_:1})]),_:1})]),_:1}))]),_:1}),s("div",de,[e[16]||(e[16]=s("b",null,"Total:",-1)),f(" "+r(n.money(n.total))+" Bs ",1)]),l(m,{class:"q-mt-md",color:"indigo",icon:"shopping_cart",label:"Pagar",disable:!o.cart.length,loading:o.loading,"no-caps":"",onClick:n.openPayDialog},null,8,["disable","loading","onClick"])]),_:1})]),_:1})])]),l(D,{modelValue:o.payDlg,"onUpdate:modelValue":e[11]||(e[11]=t=>o.payDlg=t),persistent:""},{default:i(()=>[l(b,{style:{width:"860px","max-width":"95vw"}},{default:i(()=>[l(p,{class:"q-pa-sm row items-center"},{default:i(()=>[e[17]||(e[17]=s("div",{class:"text-h6 text-bold"},"Pago",-1)),l(_),l(m,{flat:"",dense:"",icon:"close",onClick:e[2]||(e[2]=t=>o.payDlg=!1)})]),_:1}),l(p,{class:"q-pt-none"},{default:i(()=>[s("div",re,[s("div",ce,[l(h,{modelValue:o.client.ci,"onUpdate:modelValue":[e[3]||(e[3]=t=>o.client.ci=t),n.searchClient],label:"CI/NIT",outlined:"",dense:"",clearable:"",debounce:"300"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",me,[l(h,{modelValue:o.client.name,"onUpdate:modelValue":[e[4]||(e[4]=t=>o.client.name=t),n.toUpperName],label:"Nombre",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ue,[l(w,{modelValue:o.client.mesa,"onUpdate:modelValue":e[5]||(e[5]=t=>o.client.mesa=t),label:"Mesa",outlined:"",dense:"",options:["MESA","LLEVAR","DELIVERY","PEDIDOS YA"]},null,8,["modelValue"])]),s("div",ge,[l(w,{modelValue:o.client.pago,"onUpdate:modelValue":e[6]||(e[6]=t=>o.client.pago=t),label:"Pago",outlined:"",dense:"",options:["EFECTIVO","QR"]},null,8,["modelValue"])]),s("div",pe,[l(w,{modelValue:o.client.llamada,"onUpdate:modelValue":e[7]||(e[7]=t=>o.client.llamada=t),label:"Llamada",outlined:"",dense:"",options:o.cantidades},null,8,["modelValue","options"])]),s("div",he,[l(h,{modelValue:o.client.comment,"onUpdate:modelValue":e[8]||(e[8]=t=>o.client.comment=t),label:"Comentario",outlined:"",dense:""},null,8,["modelValue"])])]),l(A,{class:"q-my-sm"}),s("div",fe,[s("div",be,[l(h,{modelValue:o.recibido,"onUpdate:modelValue":e[9]||(e[9]=t=>o.recibido=t),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Monto recibido",outlined:"",dense:""},null,8,["modelValue"])]),s("div",ye," Total: "+r(n.money(n.total))+" Bs ",1),s("div",_e,[o.recibido!==""?(d(),c("span",ve,"Cambio: "+r(n.money(o.recibido-n.total))+" Bs",1)):C("",!0)])])]),_:1}),l(B,{align:"right"},{default:i(()=>[l(m,{flat:"",color:"negative",label:"Cancelar","no-caps":"",onClick:e[10]||(e[10]=t=>o.payDlg=!1)}),l(m,{color:"positive",label:"Confirmar y cobrar","no-caps":"",loading:o.loading,onClick:n.submitSale},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[18]||(e[18]=s("div",{id:"myelement",class:"hidden"},null,-1))]),_:1})}const Ne=U(M,[["render",xe],["__scopeId","data-v-e9709779"]]);export{Ne as default};
