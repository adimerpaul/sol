import{_ as w,c as h,o as d,w as a,a7 as C,aa as f,a9 as g,Q as c,a as e,e as i,b as o,af as x,f as p,O as _,t as m,a8 as k}from"./index-D17d9CED.js";import{Q as D}from"./QSpace-CRJFh_fq.js";import{Q as N}from"./QTooltip-BM3pJKYk.js";import{Q as V}from"./QPage-Mqie5rLH.js";import{h as y}from"./moment-BLMuvzoS.js";import"./position-engine-DqQ8RByf.js";const B={name:"IndexPage",data(){return{loading:!1,fullScreenChart:!1,filters:{date_from:"",date_to:""},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},porDia:[],pagos:[],chartVentas:{series:[],options:{}},chartPagos:{series:[],options:{}}}},mounted(){this.prefillDates(),this.fetchDashboard()},methods:{prefillDates(){this.filters.date_from=y().format("YYYY-MM-DD"),this.filters.date_to=y().format("YYYY-MM-DD")},async fetchDashboard(){this.loading=!0;try{const l={...this.filters},{data:s}=await this.$axios.get("reportes/ventas",{params:l});this.kpis=s?.kpis||this.kpis,this.porDia=s?.por_dia||[],this.pagos=s?.pagos||[],this.buildChartVentas(),this.buildChartPagos()}catch(l){const s=l?.response?.data?.message||"No se pudo cargar el dashboard";this.$q.notify?.({type:"negative",message:s})}finally{this.loading=!1}},buildChartVentas(){const l=this.porDia.map(t=>t.date),s=this.porDia.map(t=>Number(t.ingreso||0)),r=this.porDia.map(t=>Number(t.egreso||0)),v=this.porDia.map(t=>Number(t.neto||0));this.chartVentas={series:[{name:"Ingresos",data:s},{name:"Egresos",data:r},{name:"Neto",data:v}],options:{chart:{type:"bar",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},xaxis:{categories:l,labels:{rotate:-45}},yaxis:{labels:{formatter:t=>Number(t||0).toFixed(0)}},legend:{position:"top"},tooltip:{y:{formatter:t=>this.money(t)+" Bs"}}}}},buildChartPagos(){const l=this.pagos.map(r=>r.pago||"SN"),s=this.pagos.map(r=>Number(r.total||0));this.chartPagos={series:s,options:{labels:l,legend:{position:"bottom"},tooltip:{y:{formatter:r=>this.money(r)+" Bs"}}}}},money(l){return Number(l||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},Q={class:"row items-center q-col-gutter-sm"},P={class:"col-12 col-sm-3"},q={class:"col-12 col-sm-3"},S={class:"col-12 col-sm-3 col-md-2"},Y={class:"row q-col-gutter-sm"},I={class:"col-6 col-sm-3"},M={class:"col-6 col-sm-3"},A={class:"col-6 col-sm-3"},E={class:"col-6 col-sm-3"},F={key:1,class:"row q-col-gutter-md q-mb-md"},R={class:"col-12 col-sm-6 col-md-3"},T={class:"text-h5 text-weight-bold"},L={class:"col-12 col-sm-6 col-md-3"},O={class:"text-h5 text-weight-bold"},U={class:"col-12 col-sm-6 col-md-3"},j={class:"text-h5 text-weight-bold"},z={class:"text-caption text-grey"},H={class:"col-12 col-sm-6 col-md-3"},G={class:"text-h5 text-weight-bold"},J={class:"text-caption text-grey"},K={key:2,class:"row q-col-gutter-md"},W={class:"col-12 col-md-8"},X={key:1,class:"text-grey text-center q-pa-md text-caption"},Z={class:"col-12 col-md-4"},$={key:1,class:"text-grey text-center q-pa-md text-caption"};function ss(l,s,r,v,t,u){const b=C("apexchart");return d(),h(V,{class:"q-pa-md bg-grey-3"},{default:a(()=>[l.$store.user.role=="Administrador"?(d(),h(c,{key:0,flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(i,null,{default:a(()=>[o("div",Q,[s[7]||(s[7]=o("div",{class:"col-12 col-md-6"},[o("div",{class:"text-h5 text-weight-bold"}," Dashboard general "),o("div",{class:"text-caption text-grey-7"}," Resumen rápido de ventas, caja e insumos ")],-1)),o("div",P,[e(x,{modelValue:t.filters.date_from,"onUpdate:modelValue":s[0]||(s[0]=n=>t.filters.date_from=n),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),o("div",q,[e(x,{modelValue:t.filters.date_to,"onUpdate:modelValue":s[1]||(s[1]=n=>t.filters.date_to=n),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),o("div",S,[e(p,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",class:"full-width",loading:t.loading,onClick:u.fetchDashboard},null,8,["loading","onClick"])])])]),_:1}),e(_),e(i,null,{default:a(()=>[o("div",Y,[o("div",I,[e(p,{color:"primary",icon:"point_of_sale",label:"Nueva venta","no-caps":"",class:"full-width",onClick:s[2]||(s[2]=n=>l.$router.push({path:"/ventas"}))})]),o("div",M,[e(p,{color:"teal",icon:"shopping_cart",label:"Nueva compra","no-caps":"",class:"full-width",onClick:s[3]||(s[3]=n=>l.$router.push({path:"/compras"}))})]),o("div",A,[e(p,{color:"indigo",icon:"inventory_2",label:"Productos","no-caps":"",class:"full-width",onClick:s[4]||(s[4]=n=>l.$router.push({path:"/productos"}))})]),o("div",E,[e(p,{color:"orange",outline:"",icon:"insights",label:"Reportes detallados","no-caps":"",class:"full-width",onClick:s[5]||(s[5]=n=>l.$router.push({path:"/reportes"}))})])])]),_:1})]),_:1})):f("",!0),l.$store.user.role=="Administrador"?(d(),g("div",F,[o("div",R,[e(c,{flat:"",bordered:"",class:"kpi kpi-green"},{default:a(()=>[e(i,null,{default:a(()=>[s[8]||(s[8]=o("div",{class:"text-caption text-positive"},"Ingresos",-1)),o("div",T,m(u.money(t.kpis.ingresos))+" Bs ",1)]),_:1})]),_:1})]),o("div",L,[e(c,{flat:"",bordered:"",class:"kpi kpi-red"},{default:a(()=>[e(i,null,{default:a(()=>[s[9]||(s[9]=o("div",{class:"text-caption text-negative"},"Egresos",-1)),o("div",O,m(u.money(t.kpis.egresos))+" Bs ",1)]),_:1})]),_:1})]),o("div",U,[e(c,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:a(()=>[e(i,null,{default:a(()=>[s[10]||(s[10]=o("div",{class:"text-caption"},"Neto",-1)),o("div",j,m(u.money(t.kpis.neto))+" Bs ",1),o("div",z," Ticket prom.: "+m(u.money(t.kpis.ticket_promedio))+" Bs ",1)]),_:1})]),_:1})]),o("div",H,[e(c,{flat:"",bordered:"",class:"kpi"},{default:a(()=>[e(i,null,{default:a(()=>[s[11]||(s[11]=o("div",{class:"text-caption"},"Resumen de ventas",-1)),o("div",G,m(t.kpis.ventas)+" ventas ",1),o("div",J," Ítems vendidos: "+m(t.kpis.items),1)]),_:1})]),_:1})])])):f("",!0),l.$store.user.role=="Administrador"?(d(),g("div",K,[o("div",W,[e(c,{flat:"",bordered:""},{default:a(()=>[e(i,{class:"row items-center"},{default:a(()=>[s[13]||(s[13]=o("div",{class:"text-subtitle1 text-weight-bold"}," Movimiento diario (Ingresos vs Egresos vs Neto) ",-1)),e(D),e(p,{dense:"",flat:"",icon:"fullscreen",round:"",onClick:s[6]||(s[6]=n=>t.fullScreenChart=!t.fullScreenChart)},{default:a(()=>[e(N,null,{default:a(()=>[...s[12]||(s[12]=[k(" Cambiar tamaño ",-1)])]),_:1})]),_:1})]),_:1}),e(_),e(i,null,{default:a(()=>[t.chartVentas.series.length?(d(),h(b,{key:0,type:"bar",height:"320",options:t.chartVentas.options,series:t.chartVentas.series},null,8,["options","series"])):(d(),g("div",X," No hay datos en el rango seleccionado. "))]),_:1})]),_:1})]),o("div",Z,[e(c,{flat:"",bordered:""},{default:a(()=>[e(i,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>[...s[14]||(s[14]=[k(" Ventas por tipo de pago ",-1)])]),_:1}),e(_),e(i,null,{default:a(()=>[t.chartPagos.series.length?(d(),h(b,{key:0,type:"donut",height:"320",options:t.chartPagos.options,series:t.chartPagos.series},null,8,["options","series"])):(d(),g("div",$," No hay ventas por tipo de pago en este rango. "))]),_:1})]),_:1})])])):f("",!0)]),_:1})}const rs=w(B,[["render",ss],["__scopeId","data-v-fd981195"]]);export{rs as default};
