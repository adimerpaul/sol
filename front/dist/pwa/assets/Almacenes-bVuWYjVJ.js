import{_ as Q,c as f,o as p,w as s,a as e,af as r,a8 as u,t as b,P as k,d as g,f as d,h as v,Q as C,e as w,b as a,ao as x}from"./index-D17d9CED.js";import{c as N,Q as _,b as c,a as V}from"./QList-DtAzkZzK.js";import{Q as U}from"./QBtnDropdown-DZ9Zwjea.js";import{Q as h}from"./QTd-D0V8Af-v.js";import{Q as S}from"./format-C2NjPuPn.js";import{Q as D}from"./QTable-ndNxYlyN.js";import{Q as B}from"./QSpace-CRJFh_fq.js";import{Q as q}from"./QSelect-CvCEXiBv.js";import{Q as A}from"./QForm-DCBzBiBo.js";import{Q as E}from"./QPage-Mqie5rLH.js";import{C as y}from"./ClosePopup-DI1WlcTZ.js";import"./position-engine-DqQ8RByf.js";const M={name:"AlmacenesPage",data(){return{rows:[],loading:!1,filter:"",dlg:!1,item:{},unidades:[{label:"UND",value:"UND"},{label:"KG",value:"KG"},{label:"LT",value:"LT"},{label:"PAQ",value:"PAQ"}],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre",sortable:!0},{name:"unidad",label:"Unidad",align:"left",field:"unidad",sortable:!0},{name:"stock",label:"Stock",align:"left",field:"stock",sortable:!0},{name:"costo",label:"Costo (Bs)",align:"left",field:"costo",sortable:!0},{name:"min_stock",label:"Mínimo",align:"left",field:"min_stock"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"}]}},mounted(){this.fetchRows()},methods:{async updateStock(i){if(i.id)try{await this.$axios.put(`almacenes/${i.id}`,{stock:i.stock}),this.$alert?.success?.("Stock actualizado")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo actualizar el stock")}},formatMoney(i){return i=Number(i||0),i.toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},async fetchRows(){this.loading=!0;try{const i=await this.$axios.get("almacenes");this.rows=i.data}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar")}finally{this.loading=!1}},onNew(){this.item={nombre:"",unidad:"UND",stock:0,costo:0,min_stock:null,descripcion:""},this.dlg=!0},onEdit(i){this.item={...i},this.dlg=!0},async onDelete(i){this.$alert.dialog("¿Eliminar el almacén?").onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`almacenes/${i}`),this.$alert?.success?.("Eliminado"),this.fetchRows()}catch(o){this.$alert?.error?.(o.response?.data?.message||"Error al eliminar")}finally{this.loading=!1}})},async submit(){this.loading=!0;try{this.item.id?(await this.$axios.put(`almacenes/${this.item.id}`,this.item),this.$alert?.success?.("Actualizado")):(await this.$axios.post("almacenes",this.item),this.$alert?.success?.("Creado")),this.dlg=!1,this.fetchRows()}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}}}},P={class:"row q-col-gutter-sm"},z={class:"col-12 col-sm-8"},I={class:"col-12 col-sm-4"},L={class:"col-6"},R={class:"col-6"},T={class:"col-6"},F={class:"col-12"},G={class:"text-right q-mt-md"};function O(i,o,K,j,t,n){return p(),f(E,{class:"q-pa-md"},{default:s(()=>[e(D,{rows:t.rows,columns:t.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Almacenes",filter:t.filter},{"top-right":s(()=>[e(d,{color:"positive",label:"Nuevo",onClick:n.onNew,"no-caps":"",icon:"add_circle_outline",loading:t.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),e(d,{color:"primary",label:"Actualizar",onClick:n.fetchRows,"no-caps":"",icon:"refresh",loading:t.loading},null,8,["onClick","loading"]),e(r,{modelValue:t.filter,"onUpdate:modelValue":o[0]||(o[0]=l=>t.filter=l),label:"Buscar",dense:"",outlined:"",class:"q-ml-sm"},{append:s(()=>[e(g,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(l=>[e(h,{props:l},{default:s(()=>[e(U,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[e(N,null,{default:s(()=>[k((p(),f(_,{clickable:"",onClick:m=>n.onEdit(l.row)},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(g,{name:"edit"})]),_:1}),e(c,null,{default:s(()=>[e(V,null,{default:s(()=>[...o[10]||(o[10]=[u("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]]),k((p(),f(_,{clickable:"",onClick:m=>n.onDelete(l.row.id)},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(g,{name:"delete"})]),_:1}),e(c,null,{default:s(()=>[e(V,null,{default:s(()=>[...o[11]||(o[11]=[u("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-costo":s(l=>[e(h,{props:l},{default:s(()=>[u(b(n.formatMoney(l.row.costo)),1)]),_:2},1032,["props"])]),"body-cell-stock":s(l=>[e(h,{props:l},{default:s(()=>[e(r,{modelValue:l.row.stock,"onUpdate:modelValue":[m=>l.row.stock=m,m=>n.updateStock(l.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",step:"0.01",style:{"max-width":"150px"},debounce:"500"},{append:s(()=>[e(S,{dense:"",color:l.row.min_stock&&Number(l.row.stock)<=Number(l.row.min_stock)?"negative":"primary","text-color":"white"},{default:s(()=>[u(b(l.row.unidad),1)]),_:2},1032,["color"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),e(v,{modelValue:t.dlg,"onUpdate:modelValue":o[9]||(o[9]=l=>t.dlg=l),persistent:""},{default:s(()=>[e(C,{style:{width:"520px","max-width":"90vw"}},{default:s(()=>[e(w,{class:"q-pb-none row items-center"},{default:s(()=>[a("div",null,b(t.item.id?"Editar":"Nuevo")+" almacén",1),e(B),e(d,{icon:"close",flat:"",round:"",dense:"",onClick:o[1]||(o[1]=l=>t.dlg=!1)})]),_:1}),e(w,{class:"q-pt-none"},{default:s(()=>[e(A,{onSubmit:x(n.submit,["prevent"])},{default:s(()=>[a("div",P,[a("div",z,[e(r,{modelValue:t.item.nombre,"onUpdate:modelValue":o[2]||(o[2]=l=>t.item.nombre=l),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"])]),a("div",I,[e(q,{modelValue:t.item.unidad,"onUpdate:modelValue":o[3]||(o[3]=l=>t.item.unidad=l),label:"Unidad",dense:"",outlined:"",options:t.unidades,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",L,[e(r,{modelValue:t.item.stock,"onUpdate:modelValue":o[4]||(o[4]=l=>t.item.stock=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock",dense:"",outlined:""},null,8,["modelValue"])]),a("div",R,[e(r,{modelValue:t.item.costo,"onUpdate:modelValue":o[5]||(o[5]=l=>t.item.costo=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Costo (Bs)",dense:"",outlined:""},null,8,["modelValue"])]),a("div",T,[e(r,{modelValue:t.item.min_stock,"onUpdate:modelValue":o[6]||(o[6]=l=>t.item.min_stock=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock mínimo",dense:"",outlined:""},null,8,["modelValue"])]),a("div",F,[e(r,{modelValue:t.item.descripcion,"onUpdate:modelValue":o[7]||(o[7]=l=>t.item.descripcion=l),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"])])]),a("div",G,[e(d,{color:"negative",label:"Cancelar","no-caps":"",onClick:o[8]||(o[8]=l=>t.dlg=!1),loading:t.loading},null,8,["loading"]),e(d,{color:"primary",label:"Guardar","no-caps":"",class:"q-ml-sm",type:"submit",loading:t.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ie=Q(M,[["render",O]]);export{ie as default};
