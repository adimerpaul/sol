import{_ as w,c as g,o as v,w as s,a as o,Q as m,e as r,b as l,af as b,d as c,f as u,t as d,aa as x,a8 as f,h as y}from"./index-D17d9CED.js";import{Q as V}from"./format-C2NjPuPn.js";import{Q as h}from"./QTd-D0V8Af-v.js";import{Q as p}from"./QTable-ndNxYlyN.js";import{Q as q}from"./QSpace-CRJFh_fq.js";import{Q as N}from"./QPage-Mqie5rLH.js";import"./position-engine-DqQ8RByf.js";import"./QList-DtAzkZzK.js";import"./QSelect-CvCEXiBv.js";const Q={name:"MovimientosAlmacenInsumosIndex",data(){const t=new Date().toISOString().substr(0,10);return{f:{ini:t,fin:t,q:""},loading:!1,rows:[],dlgVer:!1,mov:null,columns:[{name:"id",label:"#",field:"id",align:"left",sortable:!0},{name:"fecha",label:"Fecha",field:"fecha",align:"left",sortable:!0},{name:"detalles_count",label:"Ítems",field:"detalles_count",align:"right"},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:e=>Number(e||0).toFixed(2),sortable:!0},{name:"estado",label:"Estado",field:"estado",align:"left",sortable:!0},{name:"opciones",label:"Opciones",field:"opciones",align:"center"}],colsDetalles:[{name:"almacen",label:"Desde almacén",align:"left",field:e=>e.almacen&&e.almacen.nombre?e.almacen.nombre:""},{name:"insumo",label:"Hacia insumo",align:"left",field:e=>e.insumo&&e.insumo.nombre?e.insumo.nombre:""},{name:"unidad",label:"Unidad",align:"left",field:e=>e.almacen&&e.almacen.unidad?e.almacen.unidad:""},{name:"cantidad",label:"Cantidad",align:"right",field:"cantidad"},{name:"costo",label:"Costo",align:"right",field:e=>Number(e.costo||0).toFixed(2)},{name:"subtotal",label:"Subtotal",align:"right",field:e=>Number(e.subtotal||0).toFixed(2)}]}},computed:{totalMovimientos(){return this.rows.reduce((t,e)=>t+Number(e.total||0),0)},totalAnulados(){return this.rows.filter(t=>t.estado==="ANULADO").reduce((t,e)=>t+Number(e.total||0),0)},totalVigentes(){return this.rows.filter(t=>t.estado!=="ANULADO").reduce((t,e)=>t+Number(e.total||0),0)}},mounted(){this.fetch()},methods:{money(t){return Number(t||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},async fetch(){this.loading=!0;try{const t=await this.$axios.post("movimientos-almacen-insumos/report",{fechaInicio:this.f.ini,fechaFin:this.f.fin,q:this.f.q});this.rows=t.data}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo cargar los movimientos")}finally{this.loading=!1}},async ver(t){try{const e=await this.$axios.get(`movimientos-almacen-insumos/${t}`);this.mov=e.data,this.dlgVer=!0}catch{this.$alert?.error?.("No se pudo abrir el movimiento")}},anular(t){this.$alert.dialog("¿Anular el movimiento? Esto restaurará los stocks.").onOk(async()=>{this.loading=!0;try{await this.$axios.put(`movimientos-almacen-insumos/${t}/anular`),this.$alert?.success?.("Movimiento anulado"),this.fetch()}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo anular")}finally{this.loading=!1}})}}},k={class:"row items-end q-col-gutter-sm"},C={class:"col-12 col-md-3"},A={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},D={class:"col-12 col-md-3 text-right"},F={class:"row q-col-gutter-sm"},I={class:"col-xs-12 col-md-4"},O={class:"text-h6 text-weight-bold"},S={class:"col-xs-12 col-md-4"},U={class:"text-h6 text-weight-bold"},M={class:"col-xs-12 col-md-4"},T={class:"text-h6 text-weight-bold"},L={class:"full-width row flex-center text-grey q-gutter-sm"},z={class:"text-subtitle1"},E={class:"q-mb-sm"},H={class:"text-right text-subtitle1 q-mt-sm"};function P(t,e,j,G,a,n){return v(),g(N,{class:"q-pa-md bg-grey-3"},{default:s(()=>[o(m,{flat:"",bordered:"",class:"q-pa-sm"},{default:s(()=>[o(r,{class:"q-pa-sm"},{default:s(()=>[l("div",k,[l("div",C,[o(b,{modelValue:a.f.ini,"onUpdate:modelValue":e[0]||(e[0]=i=>a.f.ini=i),label:"Fecha inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),l("div",A,[o(b,{modelValue:a.f.fin,"onUpdate:modelValue":e[1]||(e[1]=i=>a.f.fin=i),label:"Fecha fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),l("div",B,[o(b,{modelValue:a.f.q,"onUpdate:modelValue":e[2]||(e[2]=i=>a.f.q=i),label:"Buscar (nota / estado)",dense:"",outlined:"",clearable:""},{append:s(()=>[o(c,{name:"search"})]),_:1},8,["modelValue"])]),l("div",D,[o(u,{color:"primary",label:"Nuevo movimiento",icon:"call_made","no-caps":"",class:"q-mr-sm",to:{path:"/movimientos-almacen-insumos/nuevo"}}),o(u,{color:"indigo",label:"Buscar",icon:"search","no-caps":"",loading:a.loading,onClick:n.fetch},null,8,["loading","onClick"])])])]),_:1}),o(r,{class:"q-pt-none"},{default:s(()=>[l("div",F,[l("div",I,[o(m,{flat:"",bordered:"",class:"bg-blue-1"},{default:s(()=>[o(r,{class:"row items-center"},{default:s(()=>[o(c,{name:"sync_alt",color:"blue",size:"md",class:"q-mr-sm"}),l("div",null,[e[5]||(e[5]=l("div",{class:"text-caption"},"Total Movimientos (Bs)",-1)),l("div",O,d(n.money(n.totalMovimientos)),1)])]),_:1})]),_:1})]),l("div",S,[o(m,{flat:"",bordered:"",class:"bg-red-1"},{default:s(()=>[o(r,{class:"row items-center"},{default:s(()=>[o(c,{name:"block",color:"red",size:"md",class:"q-mr-sm"}),l("div",null,[e[6]||(e[6]=l("div",{class:"text-caption"},"Anulados (Bs)",-1)),l("div",U,d(n.money(n.totalAnulados)),1)])]),_:1})]),_:1})]),l("div",M,[o(m,{flat:"",bordered:"",class:"bg-green-1"},{default:s(()=>[o(r,{class:"row items-center"},{default:s(()=>[o(c,{name:"check_circle",color:"green",size:"md",class:"q-mr-sm"}),l("div",null,[e[7]||(e[7]=l("div",{class:"text-caption"},"Vigentes (Bs)",-1)),l("div",T,d(n.money(n.totalVigentes)),1)])]),_:1})]),_:1})])])]),_:1}),o(r,{class:"q-pt-none"},{default:s(()=>[o(p,{rows:a.rows,columns:a.columns,"row-key":"id",flat:"",bordered:"",dense:"","rows-per-page-options":[0],loading:a.loading,"hide-bottom":"","binary-state-sort":""},{"body-cell-estado":s(i=>[o(h,{props:i},{default:s(()=>[o(V,{dense:"",square:"",color:i.row.estado==="ANULADO"?"negative":"primary","text-color":"white"},{default:s(()=>[f(d(i.row.estado),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-opciones":s(i=>[o(h,{props:i},{default:s(()=>[o(u,{flat:"",dense:"",round:"",icon:"visibility",onClick:_=>n.ver(i.row.id),title:"Ver movimiento #"+i.row.id},null,8,["onClick","title"]),i.row.estado==="ACTIVO"?(v(),g(u,{key:0,flat:"",dense:"",round:"",icon:"block",color:"negative",onClick:_=>n.anular(i.row.id),title:"Anular movimiento"},null,8,["onClick"])):x("",!0)]),_:2},1032,["props"])]),"no-data":s(()=>[l("div",L,[o(c,{name:"inbox"}),e[8]||(e[8]=l("span",null,"Sin movimientos registrados",-1))])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1}),o(y,{modelValue:a.dlgVer,"onUpdate:modelValue":e[4]||(e[4]=i=>a.dlgVer=i)},{default:s(()=>[o(m,{style:{"min-width":"720px"}},{default:s(()=>[o(r,{class:"row items-center q-pb-none"},{default:s(()=>[l("div",z," Movimiento #"+d(a.mov?a.mov.id:""),1),o(q),o(u,{flat:"",round:"",dense:"",icon:"close",onClick:e[3]||(e[3]=i=>a.dlgVer=!1)})]),_:1}),o(r,{class:"q-pt-none"},{default:s(()=>[l("div",E,[l("div",null,[e[9]||(e[9]=l("b",null,"Fecha:",-1)),f(" "+d(a.mov?.fecha),1)]),l("div",null,[e[10]||(e[10]=l("b",null,"Estado:",-1)),f(" "+d(a.mov?.estado),1)]),l("div",null,[e[11]||(e[11]=l("b",null,"Nota:",-1)),f(" "+d(a.mov?.nota||"—"),1)])]),o(p,{rows:a.mov?.detalles||[],columns:a.colsDetalles,dense:"",flat:"",bordered:"","rows-per-page-options":[0],"hide-bottom":""},null,8,["rows","columns"]),l("div",H,[e[12]||(e[12]=l("b",null,"Total:",-1)),f(" "+d(n.money(a.mov?.total||0))+" Bs ",1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const oe=w(Q,[["render",P]]);export{oe as default};
